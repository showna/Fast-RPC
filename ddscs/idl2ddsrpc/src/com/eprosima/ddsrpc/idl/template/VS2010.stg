/* $Id$   *
 * (c) Copyright, eProsima, 2012.                                          *
 * All rights reserved.                                                    *    
 *                                                                         *
 * No duplications, whole or partial, manual or electronic, may be made    *
 * without express written permission.  Any such copies, or                *
 * revisions thereof, must display this notice unaltered.                  *
 * This code contains trade secrets of                                     *
 * eProsima (Proyectos y Sistemas de Mantenimiento S.L.)                   *
 *                                                                         *
 * modification history                                                    *
 * --------------------                                                    *
 * 1.0,30jun12,RicG Created                                                *
 * =====================================================================   *
 */

group VS2010;

/************************************************************************
 *                                                                      *
 *   External Templates: Common Templates for C++ code generation       *
 *                                                                      *
 ************************************************************************
 */
/**
 * solution: External Template
 * Produces a VS2010 solution file 
 * 
 * Params:
 *   projects       : List of objects with name, guid and dependsOn properties.
 *   configurations : List of configuration names. 
 *
 * Uses:
 *   projectRef                    - local
 *   projectConfigurationPlatforms - local
 */ 
solution(projects, configurations) ::= <<
Microsoft Visual Studio Solution File, Format Version 11.00
# Visual Studio 2010
$projects:{$projectRef(it)$};separator="\n"$
Global
$\t$GlobalSection(SolutionConfigurationPlatforms) = preSolution
$configurations:{conf |$\t$$\t$$conf.name$|$conf.platform$ = $conf.name$|$conf.platform$};separator="\n"$
$\t$EndGlobalSection
$\t$GlobalSection(ProjectConfigurationPlatforms) = postSolution
$projects:{$projectConfigurationPlatforms(guid=it.guid, configurations=configurations)$};separator="\n"$
$\t$EndGlobalSection
$\t$GlobalSection(SolutionProperties) = preSolution
$\t$$\t$HideSolutionNode = FALSE
$\t$EndGlobalSection
EndGlobal

>>

/**
 * project: External Template
 * Produces a VS2005 C++ project file (.vcproj)  
 * 
 * Params:
 *   guid           : GUID for this project.
 *   name           : project name. 
 *   configurations : List of VSConfiguration objects that 
 *                    have name string property and
 *                    boolean debugDll, releaseDll, debug & release properties.
 *   sourceFiles    : List with the sources of this project.
 *   headerFiles    : List with the headers of this project.
 * Uses:
 *   configuration - local
 *   filter        - local
 */ 
project(interfaceName, guid, name, example, arch, configurations, client) ::= <<
<?xml version="1.0" encoding="Windows-1252"?>
<Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <ItemGroup Label="ProjectConfigurations">
    $configurations:{<ProjectConfiguration Include="$it.name$|$it.platform$">
      <Configuration>$it.name$</Configuration>
      <Platform>$it.platform$</Platform>
    </ProjectConfiguration>};separator="\n"$
  </ItemGroup>
  <PropertyGroup Label="Globals">
    <ProjectName>$name$</ProjectName>
    <ProjectGuid>{$guid$}</ProjectGuid>
    <RootNamespace>$name$</RootNamespace>
  </PropertyGroup>
  <Import Project="\$(VCTargetsPath)\Microsoft.Cpp.Default.props" />
  $configurations:{<PropertyGroup Condition="'\$(Configuration)|\$(Platform)'=='$it.name$|$it.platform$'" Label="Configuration">
    <ConfigurationType>Application</ConfigurationType>
    <UseOfMfc>false</UseOfMfc>
    <CharacterSet>MultiByte</CharacterSet>
  </PropertyGroup>};separator="\n"$
  <Import Project="\$(VCTargetsPath)\Microsoft.Cpp.props" />
  <ImportGroup Label="ExtensionSettings">
  </ImportGroup>
  $configurations:{<ImportGroup Label="PropertySheets" Condition="'\$(Configuration)|\$(Platform)'=='$it.name$|$it.platform$'">
    <Import Project="\$(UserRootDir)\Microsoft.Cpp.\$(Platform).user.props" Condition="exists('\$(UserRootDir)\Microsoft.Cpp.\$(Platform).user.props')" Label="LocalAppDataPlatform" />
  </ImportGroup>};separator="\n"$
  <PropertyGroup Label="UserMacros" />
  $configurations:{<PropertyGroup Condition="'\$(Configuration)|\$(Platform)'=='$it.name$|$it.platform$'">
    <OutDir>.\objs\\$example$\</OutDir>
    <IntDir>.\objs\\$example$\</IntDir>
    <CodeAnalysisRuleSet>AllRules.ruleset</CodeAnalysisRuleSet>
    <CodeAnalysisRules/>
    <CodeAnalysisRuleAssemblies/>
  </PropertyGroup>};separator="\n"$
  $configurations:{<ItemDefinitionGroup Condition="'\$(Configuration)|\$(Platform)'=='$it.name$|$it.platform$'">
    <ClCompile>
      <Optimization>$if(it.debug)$Disabled$else$MaxSpeed$endif$</Optimization>
      <AdditionalIncludeDirectories>$inclVS()$%(AdditionalIncludeDirectories)</AdditionalIncludeDirectories>
      <PreprocessorDefinitions>$preprocessorDefs(conf=it)$</PreprocessorDefinitions>
      <BasicRuntimeChecks>$if(it.debug)$EnableFastChecks$else$Default$endif$</BasicRuntimeChecks>
      <RuntimeLibrary>$runtimeLibrary(conf=it)$</RuntimeLibrary>
      <PrecompiledHeader>
      </PrecompiledHeader>
      <PrecompiledHeaderOutputFile>
      </PrecompiledHeaderOutputFile>
      <AssemblerListingLocation>.\objs\\$example$\</AssemblerListingLocation>
      <ObjectFileName>.\objs\\$example$\</ObjectFileName>
      <ProgramDataBaseFileName>.\objs\\$example$\</ProgramDataBaseFileName>
      <WarningLevel>Level3</WarningLevel>
      <SuppressStartupBanner>true</SuppressStartupBanner>
      <DebugInformationFormat>ProgramDatabase</DebugInformationFormat>
      <CompileAs>Default</CompileAs>
    </ClCompile>
    <Link>
      <AdditionalDependencies>$dependencies(conf=it)$;netapi32.lib;advapi32.lib;user32.lib;WS2_32.lib;%(AdditionalDependencies)</AdditionalDependencies>
      <OutputFile>.\objs\\$example$\\\$(ProjectName).exe</OutputFile>
      <SuppressStartupBanner>true</SuppressStartupBanner>
      <AdditionalLibraryDirectories>$libsVS(example=example)$%(AdditionalLibraryDirectories)</AdditionalLibraryDirectories>
      <IgnoreSpecificDefaultLibraries>$ignoreDefaultLibraryNames(conf=it)$;%(IgnoreSpecificDefaultLibraries)</IgnoreSpecificDefaultLibraries>
      <GenerateDebugInformation>$generateDebugInformation(conf=it)$</GenerateDebugInformation>
      <ProgramDatabaseFile>.\objs\\$example$\\$name$.pdb</ProgramDatabaseFile>
      <SubSystem>Console</SubSystem>
      <TargetMachine>$if(arch)$MachineX64$else$MachineX86$endif$</TargetMachine>
    </Link>
  </ItemDefinitionGroup>};separator="\n"$
  <ItemGroup>
    $sourceVS(interface=interfaceName)$
    $if(client)$
    <ClCompile Include="$interfaceName$Proxy.cxx" />
    <ClCompile Include="$interfaceName$ClientRPCSupport.cxx" />
    <ClCompile Include="$interfaceName$AsyncSupport.cxx" />
    <ClCompile Include="Client.cxx" />
    $else$
    <ClCompile Include="$interfaceName$Server.cxx" />
    <ClCompile Include="$interfaceName$ServerImpl.cxx" />
    <ClCompile Include="$interfaceName$ServerRPCSupport.cxx" />
    <ClCompile Include="Server.cxx" />
    $endif$
  </ItemGroup>
  <ItemGroup>
    $sourceIVS(interface=interfaceName)$
    $if(client)$
    <ClInclude Include="$interfaceName$Proxy.h" />
    <ClInclude Include="$interfaceName$ClientRPCSupport.h" />
    <ClInclude Include="$interfaceName$AsyncSupport.h" />
    $else$
    <ClInclude Include="$interfaceName$Server.h" />
    <ClInclude Include="$interfaceName$ServerImpl.h" />
    <ClInclude Include="$interfaceName$ServerRPCSupport.h" />
    $endif$
  </ItemGroup>
  <Import Project="\$(VCTargetsPath)\Microsoft.Cpp.targets" />
  <ImportGroup Label="ExtensionTargets">
  </ImportGroup>
</Project>
>>

/************************************************************************
 *                                                                      *
 *   Internal Templates: For internal use only.                         *
 *                                                                      *
 ************************************************************************
 */

/**
 * projectRef: Internal Template
 * Produces Project Reference in a VS2005/2008 solution file. 
 * 
 * Params:
 *   project : Object with name, guid and dependsOn properties.
 *
 * Uses:
 */ 
projectRef(project) ::= <<
Project("{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}") = "$project.name$", "$project.name$-vs2010.vcxproj", "{$project.guid$}"
$if(project.dependsOn)$
$\t$ProjectSection(ProjectDependencies) = postProject
$\t$$\t${$project.dependsOn$} = {$project.dependsOn$}
$\t$EndProjectSection
$endif$
EndProject
>>

/**
 * projectConfigurationPlatforms: Internal Template
 * Produces the ProjectConfigurationPlatforms section content of a VS2005 solution file
 * for the project guid provided 
 * 
 * Params:
 *   guid           : Project GUID.
 *   configurations : List of configuration names. 
 *
 * Uses:
 *   postSolution - local
 */ 
projectConfigurationPlatforms(guid, configurations) ::= <<
$configurations:{conf | $postSolution(guid = guid, conf = conf)$};separator="\n"$
>>


/**
 * postSolution: Internal Template
 * Produces the Active and Build.0 attributes in projectConfigurationPlatforms section
 * of a VS2005 solution file, for the given project guid and configuration name.
 * and configuration name.
 * 
 * Params:
 *   guid : Project GUID.
 *   conf : Configuration name. 
 *
 * Uses:
 */ 
postSolution(guid, conf) ::= <<
$\t$$\t${$guid$}.$conf.name$|$conf.platform$.ActiveCfg = $conf.name$|$conf.platform$
$\t$$\t${$guid$}.$conf.name$|$conf.platform$.Build.0 = $conf.name$|$conf.platform$
>>

/**
 * ignoreDefaultLibraryNames: Internal Template
 * Produces the IgnoreDefaultLibraryNames attribute of VCLinkerTool 
 * in a configuration section of a VS2005 .vcproj file. 
 * 
 * Params:
 *   conf : VSCOnfiguration object. 
 *
 * Uses:
 */ 
ignoreDefaultLibraryNames(conf) ::= <<
LIBCMT$if(it.debug)$D$endif$
>>

/**
 * generateDebugInformation: Internal Template
 * Produces the GenerateDebugInformation attribute of VCLinkerTool 
 * in a configuration section of a VS2005 .vcproj file. 
 * 
 * Params:
 *   conf : VSCOnfiguration object. 
 *
 * Uses:
 */ 
generateDebugInformation(conf) ::= <<
$if(conf.debug)$true$else$false$endif$
>>

/**
 * runtimeLibrary: Internal Template
 * Produces the RuntimeLibrary attribute of VCCLCompilerTool 
 * in a configuration section of a VS2005 .vcproj file. 
 * 
 * Params:
 *   conf : VSCOnfiguration object. 
 *
 * Uses:
 */ 
runtimeLibrary(conf) ::= <<
$if(it.dll)$$if(it.debug)$MultiThreadedDebugDLL$else$MultiThreadedDLL$endif$$else$$if(it.debug)$MultiThreadedDebug$else$MultiThreaded$endif$$endif$
>>
