/** 
 * Generated by DDSCS: Do not edit.  Version 1.0 *
 */

#include "UnionTestServer.h"
#include "transports/UDPTransport.h"
#include "transports/TCPTransport.h"
#include "exceptions/ServerInternalException.h"
#include "UnionTestRequestReplyPlugin.h"

#include "UnionTestServerRPCSupport.h"

UnionTestServer::UnionTestServer(std::string serviceName, eProsima::RPCDDS::ServerStrategy *strategy,
    int domainId) :
    Server(serviceName, strategy, NULL, domainId)
{
    _impl = new UnionTestServerImpl();

    createRPCs();
}

UnionTestServer::UnionTestServer(std::string serviceName, eProsima::RPCDDS::ServerStrategy *strategy,
    eProsima::RPCDDS::Transport *transport, int domainId) :
    Server(serviceName, strategy, transport, domainId)
{
    _impl = new UnionTestServerImpl();
    
    createRPCs();
}

UnionTestServer::~UnionTestServer()
{
    delete _impl;    
}

void UnionTestServer::createRPCs()
{
    this->setRPC(new UnionTest_getEmpleadoServerRPC("getEmpleado", this,
                UnionTest_getEmpleadoRequestUtils::registerType(getParticipant()),
                UnionTest_getEmpleadoReplyUtils::registerType(getParticipant()),
                &UnionTestServer::getEmpleado));

}

void UnionTestServer::getEmpleado(eProsima::RPCDDS::Server *server, void *requestData, eProsima::RPCDDS::ServerRPC *service) 
{ 
    UnionTestServer *srv = dynamic_cast<UnionTestServer*>(server);
    Empleado em1;
        
    Empleado em2;
        
    Empleado em3;
    memset(&em3, 0, sizeof(Empleado));    
    Empleado getEmpleado_ret;
    memset(&getEmpleado_ret, 0, sizeof(Empleado));       
    UnionTest_getEmpleadoReply replyData;
    
    Empleado_initialize(&em2);    

    UnionTest_getEmpleadoRequestUtils::extractTypeData(*(UnionTest_getEmpleadoRequest*)requestData, em1, em2);

    try
    {
        getEmpleado_ret = srv->_impl->getEmpleado(em1, em2, em3);

        UnionTest_getEmpleadoReplyUtils::setTypeData(replyData, em2, em3, getEmpleado_ret);
        replyData.header.rpcddsRetCode = eProsima::RPCDDS::OPERATION_SUCCESSFUL;
        replyData.header.rpcddsRetMsg = NULL;

        service->sendReply(requestData, &replyData);
    }
    catch(const eProsima::RPCDDS::ServerInternalException &ex)
    {
        memset(&replyData, 0, sizeof(replyData));
        replyData.header.rpcddsRetCode = eProsima::RPCDDS::SERVER_INTERNAL_ERROR;
        replyData.header.rpcddsRetMsg = (char*)ex.what();
        
        service->sendReply(requestData, &replyData);
    }
    
    UnionTest_getEmpleadoRequestTypeSupport::delete_data((UnionTest_getEmpleadoRequest*)requestData);
    
    Empleado_finalize(&getEmpleado_ret);    
    Empleado_finalize(&em2);    
    Empleado_finalize(&em3);    
}