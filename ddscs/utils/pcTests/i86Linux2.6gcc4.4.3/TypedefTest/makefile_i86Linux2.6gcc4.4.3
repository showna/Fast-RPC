CPP_i86Linux2.6gcc4.4.3 = g++
CXXFLAGS_i86Linux2.6gcc4.4.3 = -m32
LD_i86Linux2.6gcc4.4.3 = g++
LDFLAGS_i86Linux2.6gcc4.4.3 = -m32
SYSLIBS_i86Linux2.6gcc4.4.3 = -ldl -lnsl -lm -lpthread -lrt
DEFINES_ARCH_SPECIFIC = -DRTI_UNIX -DRTI_LINUX

DEFINES = $(DEFINES_ARCH_SPECIFIC)  

INCLUDES = -I. -I$(NDDSHOME)/include -I$(NDDSHOME)/include/ndds -I../../../../include

LIBS = -L$(NDDSHOME)/lib/i86Linux2.6gcc4.4.3 -L../../../../lib/i86Linux2.6gcc4.4.3 \
       -lnddsc -lnddscore -lnddscpp -lddsrpc $(SYSLIBS_i86Linux2.6gcc4.4.3)

COMMONSOURCES = TypedefTestRequestReply.cxx TypedefTest.cxx TypedefTestRequestReplyPlugin.cxx \
                TypedefTestPlugin.cxx TypedefTestRequestReplySupport.cxx  \
                TypedefTestRequestReplyUtils.cxx TypedefTestSupport.cxx
CLIENTSOURCES = TypedefTestProxy.cxx TypedefTestClientRPCSupport.cxx  Client.cxx 
SERVERSOURCES = TypedefTestServer.cxx TypedefTestServerImpl.cxx TypedefTestServerRPCSupport.cxx Server.cxx 
DIRECTORIES   = objs.dir objs/i86Linux2.6gcc4.4.3.dir
COMMONOBJS    = $(COMMONSOURCES:%.cxx=objs/i86Linux2.6gcc4.4.3/%.o)
CLIENTOBJS    = $(CLIENTSOURCES:%.cxx=objs/i86Linux2.6gcc4.4.3/%.o)
SERVEROBJS    = $(SERVERSOURCES:%.cxx=objs/i86Linux2.6gcc4.4.3/%.o)
CLIENTEXEC    = objs/i86Linux2.6gcc4.4.3/TypedefTestClient
SERVEREXEC    = objs/i86Linux2.6gcc4.4.3/TypedefTestServer

client: $(DIRECTORIES) $(COMMONOBJS) $(CLIENTOBJS) $(CLIENTEXEC)
server: $(DIRECTORIES) $(COMMONOBJS) $(SERVEROBJS) $(SERVEREXEC)

$(CLIENTEXEC) : 
	$(LD_i86Linux2.6gcc4.4.3) $(LDFLAGS_i86Linux2.6gcc4.4.3)  -o $(@:%.out=%) $(COMMONOBJS) $(CLIENTOBJS) $(LIBS)

$(SERVEREXEC) : 
	$(LD_i86Linux2.6gcc4.4.3) $(LDFLAGS_i86Linux2.6gcc4.4.3)  -o $(@:%.out=%) $(COMMONOBJS) $(SERVEROBJS) $(LIBS)

objs/i86Linux2.6gcc4.4.3/%.o : %.cxx
	$(CPP_i86Linux2.6gcc4.4.3) $(CXXFLAGS_i86Linux2.6gcc4.4.3)  -o $@ $(DEFINES) $(INCLUDES) -c $<

# Here is how we create those subdirectories automatically.
%.dir : 
	@echo "Checking directory $*"
	@if [ ! -d $* ]; then \
		echo "Making directory $*"; \
		mkdir -p $* ; \
	fi;
